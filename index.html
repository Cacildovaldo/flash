<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token Price Man Study</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .section { margin-bottom: 30px; border: 1px solid #ddd; padding: 15px; border-radius: 5px; }
        button { padding: 8px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #45a049; }
        input, select { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; }
        .result { margin-top: 10px; padding: 10px; background-color: #f5f5f5; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>Token Price Man Study Interface</h1>
    
    <div class="section">
        <h2>Token Operations</h2>
        <div>
            <label>Token Contract Address:</label>
            <input type="text" id="tokenAddress" placeholder="0x...">
        </div>
        <div>
            <label>Function:</label>
            <select id="tokenFunction">
                <option value="balanceOf">Check Balance</option>
                <option value="transfer">Transfer Tokens</option>
                <option value="studyMint">Study Mint (Creator Only)</option>
            </select>
        </div>
        <div id="tokenParams"></div>
        <button onclick="executeTokenFunction()">Execute</button>
        <div class="result" id="tokenResult"></div>
    </div>
    
    <div class="section">
        <h2>Uniswap Pair Operations</h2>
        <div>
            <label>Pair Contract Address:</label>
            <input type="text" id="pairAddress" placeholder="0x...">
        </div>
        <div>
            <label>Function:</label>
            <select id="pairFunction">
                <option value="getReserves">Get Reserves</option>
                <option value="swap">Execute Swap</option>
                <option value="sync">Sync Reserves</option>
            </select>
        </div>
        <div id="pairParams"></div>
        <button onclick="executePairFunction()">Execute</button>
        <div class="result" id="pairResult"></div>
    </div>
    
    <div class="section">
        <h2>Price Manipulation Scenario</h2>
        <p>This demonstrates how large swaps can affect token prices:</p>
        <button onclick="runManipulationScenario()">Run Simulation</button>
        <div class="result" id="scenarioResult"></div>
    </div>

    <script>
        let web3;
        let accounts = [];
        
        // Initialize Web3
        async function initWeb3() {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                try {
                    accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    console.log("Connected:", accounts[0]);
                } catch (error) {
                    console.error("User denied account access");
                }
            } else {
                alert("Please install MetaMask!");
            }
        }
        
        // Token Contract ABI
        const tokenABI = [
            {"inputs":[{"internalType":"string","name":"_name","type":"string"},{"internalType":"string","name":"_symbol","type":"string"},{"internalType":"uint8","name":"_decimals","type":"uint8"},{"internalType":"uint256","name":"initialSupply","type":"uint256"}],"stateMutability":"nonpayable","type":"constructor"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},
            {"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"studyMint","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}
        ];
        
        // Pair Contract ABI
        const pairABI = [
            {"inputs":[{"internalType":"address","name":"_token0","type":"address"},{"internalType":"address","name":"_token1","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"sender","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount0In","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"amount1In","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"amount0Out","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"amount1Out","type":"uint256"},{"indexed":true,"internalType":"address","name":"to","type":"address"}],"name":"Swap","type":"event"},
            {"inputs":[],"name":"getReserves","outputs":[{"internalType":"uint112","name":"_reserve0","type":"uint112"},{"internalType":"uint112","name":"_reserve1","type":"uint112"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"amount0Out","type":"uint256"},{"internalType":"uint256","name":"amount1Out","type":"uint256"},{"internalType":"address","name":"to","type":"address"}],"name":"swap","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"sync","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"token0","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"token1","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"}
        ];
        
        // Initialize on load
        window.onload = function() {
            initWeb3();
            setupFunctionSelectors();
        };
        
        // Setup parameter fields based on selected function
        function setupFunctionSelectors() {
            document.getElementById('tokenFunction').addEventListener('change', function() {
                const paramsDiv = document.getElementById('tokenParams');
                paramsDiv.innerHTML = '';
                
                switch(this.value) {
                    case 'balanceOf':
                        paramsDiv.innerHTML = '<label>Account Address:</label><input type="text" id="balanceOfAccount" placeholder="0x...">';
                        break;
                    case 'transfer':
                        paramsDiv.innerHTML = `
                            <label>To Address:</label><input type="text" id="transferTo" placeholder="0x...">
                            <label>Amount:</label><input type="number" id="transferAmount" placeholder="100">`;
                        break;
                    case 'studyMint':
                        paramsDiv.innerHTML = `
                            <label>To Address:</label><input type="text" id="mintTo" placeholder="0x...">
                            <label>Amount:</label><input type="number" id="mintAmount" placeholder="100">`;
                        break;
                }
            });
            
            document.getElementById('pairFunction').addEventListener('change', function() {
                const paramsDiv = document.getElementById('pairParams');
                paramsDiv.innerHTML = '';
                
                switch(this.value) {
                    case 'swap':
                        paramsDiv.innerHTML = `
                            <label>Token0 Out Amount:</label><input type="number" id="amount0Out" placeholder="0">
                            <label>Token1 Out Amount:</label><input type="number" id="amount1Out" placeholder="0">
                            <label>To Address:</label><input type="text" id="swapTo" placeholder="0x...">`;
                        break;
                }
            });
        }
        
        // Execute token function
        async function executeTokenFunction() {
            const tokenAddress = document.getElementById('tokenAddress').value;
            if (!tokenAddress) {
                alert("Please enter token contract address");
                return;
            }
            
            const tokenContract = new web3.eth.Contract(tokenABI, tokenAddress);
            const func = document.getElementById('tokenFunction').value;
            let result;
            
            try {
                switch(func) {
                    case 'balanceOf':
                        const account = document.getElementById('balanceOfAccount').value;
                        result = await tokenContract.methods.balanceOf(account).call();
                        break;
                    case 'transfer':
                        const to = document.getElementById('transferTo').value;
                        const amount = document.getElementById('transferAmount').value;
                        result = await tokenContract.methods.transfer(to, amount).send({ from: accounts[0] });
                        break;
                    case 'studyMint':
                        const mintTo = document.getElementById('mintTo').value;
                        const mintAmount = document.getElementById('mintAmount').value;
                        result = await tokenContract.methods.studyMint(mintTo, mintAmount).send({ from: accounts[0] });
                        break;
                }
                
                document.getElementById('tokenResult').innerHTML = `<strong>Result:</strong> ${JSON.stringify(result, null, 2)}`;
            } catch (error) {
                document.getElementById('tokenResult').innerHTML = `<strong>Error:</strong> ${error.message}`;
            }
        }
        
        // Execute pair function
        async function executePairFunction() {
            const pairAddress = document.getElementById('pairAddress').value;
            if (!pairAddress) {
                alert("Please enter pair contract address");
                return;
            }
            
            const pairContract = new web3.eth.Contract(pairABI, pairAddress);
            const func = document.getElementById('pairFunction').value;
            let result;
            
            try {
                switch(func) {
                    case 'getReserves':
                        result = await pairContract.methods.getReserves().call();
                        break;
                    case 'swap':
                        const amount0Out = document.getElementById('amount0Out').value || '0';
                        const amount1Out = document.getElementById('amount1Out').value || '0';
                        const to = document.getElementById('swapTo').value || accounts[0];
                        result = await pairContract.methods.swap(amount0Out, amount1Out, to).send({ from: accounts[0] });
                        break;
                    case 'sync':
                        result = await pairContract.methods.sync().send({ from: accounts[0] });
                        break;
                }
                
                document.getElementById('pairResult').innerHTML = `<strong>Result:</strong> ${JSON.stringify(result, null, 2)}`;
            } catch (error) {
                document.getElementById('pairResult').innerHTML = `<strong>Error:</strong> ${error.message}`;
            }
        }
        
        // Run a price manipulation scenario
        async function runManipulationScenario() {
            const resultDiv = document.getElementById('scenarioResult');
            resultDiv.innerHTML = "Running simulation...";
            
            try {
                // This is a simulation - in a real implementation you would interact with actual contracts
                const steps = [
                    "1. Creator mints a large amount of tokens to themselves",
                    "2. Creator adds initial liquidity to the pair (small amount)",
                    "3. Creator performs a series of large buys to inflate the price",
                    "4. Price appears to rise rapidly, attracting other buyers",
                    "5. Creator sells all tokens at the inflated price",
                    "6. Price crashes, leaving other investors with losses"
                ];
                
                let output = "<h3>Price Manipulation Scenario Steps:</h3><ol>";
                for (const step of steps) {
                    output += `<li>${step}</li>`;
                    // Simulate delay between steps
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
                output += "</ol><p>This demonstrates how large holders can manipulate prices in decentralized exchanges.</p>";
                
                resultDiv.innerHTML = output;
            } catch (error) {
                resultDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
            }
        }
    </script>
</body>
</html>
